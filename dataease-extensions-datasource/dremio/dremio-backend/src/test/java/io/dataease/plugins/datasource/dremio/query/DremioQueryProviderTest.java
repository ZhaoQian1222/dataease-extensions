package io.dataease.plugins.datasource.dremio.query;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.google.gson.Gson;
import io.dataease.plugins.common.base.domain.DatasetTableField;
import io.dataease.plugins.common.base.domain.Datasource;
import io.dataease.plugins.common.dto.chart.ChartFieldCustomFilterDTO;
import io.dataease.plugins.common.dto.chart.ChartViewDTO;
import io.dataease.plugins.common.dto.chart.ChartViewFieldDTO;
import io.dataease.plugins.common.request.chart.ChartExtFilterRequest;
import io.dataease.plugins.common.request.datasource.DatasourceRequest;
import io.dataease.plugins.common.request.permission.DataSetRowPermissionsTreeDTO;
import io.dataease.plugins.datasource.dremio.provider.DremioDsProvider;
import io.dataease.plugins.datasource.entity.PageInfo;
import junit.framework.TestCase;
import org.apache.commons.collections4.CollectionUtils;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class DremioQueryProviderTest extends TestCase {

    public void testTransFieldType() {
        List<Datasource> items = null;
        items.add(null);
        Datasource item1 = new Datasource();
//        item1.setId(null);
//        items.add(item1);
        Datasource item2 = new Datasource();
        item2.setId("ewew");
//        items.add(item2);
        if (CollectionUtils.isNotEmpty(items) && items.stream().map(Datasource::getId).collect(Collectors.toList()).contains("ewew")) {
            System.out.println("111");
        }

        DremioDsProvider dremioDsProvider = new DremioDsProvider();

        String datasourceStr = "{\"apiConfiguration\":[],\"configuration\":\"{\\\"initialPoolSize\\\":5,\\\"extraParams\\\":\\\"\\\",\\\"minPoolSize\\\":5,\\\"maxPoolSize\\\":50,\\\"maxIdleTime\\\":30,\\\"acquireIncrement\\\":5,\\\"idleConnectionTestPeriod\\\":5,\\\"connectTimeout\\\":5,\\\"customDriver\\\":\\\"default\\\",\\\"queryTimeout\\\":30,\\\"username\\\":\\\"zq\\\",\\\"password\\\":\\\"Calong@2015\\\",\\\"host\\\":\\\"localhost\\\",\\\"port\\\":\\\"31010\\\",\\\"dataBase\\\":\\\"space.folder\\\"}\",\"configurationEncryption\":true,\"name\":\"zq\",\"type\":\"dremio\"}";
        Datasource datasource = JSONObject.parseObject(datasourceStr, Datasource.class);
        DatasourceRequest datasourceRequest = new DatasourceRequest();
        datasourceRequest.setDatasource(datasource);

        try {
            String res = dremioDsProvider.checkStatus(datasourceRequest);
            System.out.println(res);
        } catch (Exception exception) {
            System.out.println(exception.getMessage());
        }
    }


    public void testCreateQueryTableWithPage() {
        DremioQueryProvider provider = new DremioQueryProvider();

        String table = "testzq";
//        String fieldsStr = "[{\"accuracy\":0,\"checked\":true,\"columnIndex\":0,\"dataeaseName\":\"C_b80bb7740288fda1f201890375a60c8f\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"groupType\":\"d\",\"id\":\"96441638-0dfc-42b6-bd8b-87dc6a014931\",\"lastSyncTime\":1690428810320,\"name\":\"id\",\"originName\":\"id\",\"size\":65536,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"CHARACTER VARYING\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":1,\"dataeaseName\":\"C_99bea2cd698b56b1a3b8c1701bd51c67\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"30ba71ea-3854-4ee1-a6f6-6bc0db8fcd01\",\"lastSyncTime\":1690428810320,\"name\":\"pv\",\"originName\":\"pv\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":2,\"dataeaseName\":\"C_a3b34c0871dc2fd51eec5559b68f709d\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"017fb8ad-8f7e-4da2-80f0-106dfcd0697a\",\"lastSyncTime\":1690428810320,\"name\":\"play\",\"originName\":\"play\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":3,\"dataeaseName\":\"C_a7dd12b1dab17d25467b0b0a4c8d4a92\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"d585b6ba-9258-4e2f-ab5c-c37d50c5e153\",\"lastSyncTime\":1690428810320,\"name\":\"show\",\"originName\":\"show\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":4,\"dataeaseName\":\"C_1bc33012992b99a3b7fc01faaedd04e1\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"64066bc7-6119-42fa-9052-6f487f052851\",\"lastSyncTime\":1690428810320,\"name\":\"upvote\",\"originName\":\"upvote\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":5,\"dataeaseName\":\"C_06d4cd63bde972fc66a0aed41d2f5c51\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"c5dca60f-807f-48fc-a4ea-11863ea80d32\",\"lastSyncTime\":1690428810320,\"name\":\"comment\",\"originName\":\"comment\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":6,\"dataeaseName\":\"C_be1ab1632e4285edc3733b142935c60b\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"58186c44-a643-43c2-ae4e-270aebe771fe\",\"lastSyncTime\":1690428810320,\"name\":\"like\",\"originName\":\"like\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":7,\"dataeaseName\":\"C_0788a6922bd5f9f130e7ed8980193bab\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"8ec4612a-0e34-4133-8925-e3477751b67a\",\"lastSyncTime\":1690428810320,\"name\":\"collect\",\"originName\":\"collect\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":8,\"dataeaseName\":\"C_85e47ac07ac9d6416168a97e33fa969a\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"9de95cbe-d980-4452-ba2a-cc80a8c0fc5b\",\"lastSyncTime\":1690428810320,\"name\":\"share\",\"originName\":\"share\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":9,\"dataeaseName\":\"C_e0ab074e8104870583f417cbd8afa027\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"7eb9f4bf-7539-4c00-ad7e-b3fe4d19f254\",\"lastSyncTime\":1690428810320,\"name\":\"reaction\",\"originName\":\"reaction\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":10,\"dataeaseName\":\"C_920b9115ef920ff411c979dd5a684be2\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"groupType\":\"q\",\"id\":\"dd2be540-64da-49ef-9073-0891cb7ec6c6\",\"lastSyncTime\":1690428810320,\"name\":\"re_pin\",\"originName\":\"re_pin\",\"size\":32,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"INTEGER\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":11,\"dataeaseName\":\"C_d5d3db1765287eef77d7927cc956f50a\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"groupType\":\"d\",\"id\":\"108aefc7-d21a-4958-83d4-91bd79280746\",\"lastSyncTime\":1690428810320,\"name\":\"title\",\"originName\":\"title\",\"size\":65536,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"CHARACTER VARYING\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":12,\"dataeaseName\":\"C_0faea619a3eb6dfca4ced9bbe5bf4c9a\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"groupType\":\"d\",\"id\":\"115d1017-65b2-4947-a197-c6489e696e1d\",\"lastSyncTime\":1690428810320,\"name\":\"publish_time\",\"originName\":\"publish_time\",\"size\":65536,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"CHARACTER VARYING\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":13,\"dataeaseName\":\"C_bb5855f0349346ae0b19eb381f00ab70\",\"deExtractType\":1,\"deType\":1,\"extField\":0,\"groupType\":\"d\",\"id\":\"edc3137b-0812-4b88-af54-544152da1f84\",\"lastSyncTime\":1690428810320,\"name\":\"created_time\",\"originName\":\"created_time\",\"size\":23,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"TIMESTAMP\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":14,\"dataeaseName\":\"C_2a304a1348456ccd2234cd71a81bd338\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"groupType\":\"d\",\"id\":\"41f205aa-8368-45a8-8d98-14dbb4b178bd\",\"lastSyncTime\":1690428810320,\"name\":\"link\",\"originName\":\"link\",\"size\":65536,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"CHARACTER VARYING\"},{\"accuracy\":0,\"checked\":true,\"columnIndex\":15,\"dataeaseName\":\"C_ee11cbb19052e40b07aac0ca060c23ee\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"groupType\":\"d\",\"id\":\"aec06dc3-059d-4d75-bb5b-2290e53f94ee\",\"lastSyncTime\":1690428810320,\"name\":\"user\",\"originName\":\"user\",\"size\":65536,\"tableId\":\"cc71d92a-7c7f-420b-b0b7-f8ad842b813e\",\"type\":\"CHARACTER VARYING\"}]";
        String fieldsStr = "[{\"accuracy\":0,\"checked\":true,\"columnIndex\":12,\"dataeaseName\":\"C_0faea619a3eb6dfca4ced9bbe5bf4c9a\",\"dateFormat\":\"yyyy-MM-dd\",\"dateFormatType\":\"yyyy-MM-dd\",\"deExtractType\":0,\"deType\":1,\"extField\":0,\"groupType\":\"d\",\"id\":\"05e44d6b-9e28-45ab-85b4-e52a92a6afda\",\"lastSyncTime\":1690442910315,\"name\":\"publish_time\",\"originName\":\"publish_time\",\"size\":65536,\"tableId\":\"4a235907-4062-4195-978a-7b2ac824505a\",\"type\":\"CHARACTER VARYING\"}]";
        List<DatasetTableField> fields = JSONArray.parseArray(fieldsStr, DatasetTableField.class);
        Integer page = 1;
        Integer pageSize = 1;
        Integer realSize = 1;

        String datasourceStr = "{\"configuration\":\"{\\\"initialPoolSize\\\":5,\\\"extraParams\\\":\\\"\\\",\\\"minPoolSize\\\":5,\\\"maxPoolSize\\\":50,\\\"maxIdleTime\\\":30,\\\"acquireIncrement\\\":5,\\\"idleConnectionTestPeriod\\\":5,\\\"connectTimeout\\\":5,\\\"customDriver\\\":\\\"default\\\",\\\"queryTimeout\\\":30,\\\"username\\\":\\\"zq\\\",\\\"password\\\":\\\"Calong@2015\\\",\\\"host\\\":\\\"localhost\\\",\\\"port\\\":\\\"31010\\\",\\\"dataBase\\\":\\\"dataease\\\"}\",\"createBy\":\"admin\",\"createTime\":1690429796582,\"id\":\"d797e5ea-78d9-4011-8aee-ce25c62dcae4\",\"name\":\"local\",\"status\":\"Success\",\"type\":\"dremio\",\"updateTime\":1690429796582}";
        Datasource datasource = JSONObject.parseObject(datasourceStr, Datasource.class);
        List<DataSetRowPermissionsTreeDTO> rowPermissionsTree = null;

        String sql = provider.createQueryTableWithPage(table, fields, page, pageSize, realSize, false, datasource, null, rowPermissionsTree);
        System.out.println(sql);
    }

    public void testGetSQLWithPage() {
        DremioQueryProvider qp = new DremioQueryProvider();

        String xAxisStr = "[{\"checked\":true,\"columnIndex\":4,\"dataeaseName\":\"C_ee11cbb19052e40b07aac0ca060c23ee\",\"datePattern\":\"date_sub\",\"dateStyle\":\"y_M_d\",\"deExtractType\":0,\"deType\":0,\"extField\":0,\"filter\":[],\"id\":\"9956a71f-56c4-4181-aeb0-80d6a2694120\",\"lastSyncTime\":1690971394498,\"name\":\"user\",\"originName\":\"user\",\"sort\":\"none\",\"tableId\":\"060532ec-50d2-43a2-8e5f-300d9d75bc57\",\"type\":\"CHARACTER VARYING\"},{\"checked\":true,\"columnIndex\":2,\"dataeaseName\":\"C_0faea619a3eb6dfca4ced9bbe5bf4c9a\",\"dateFormat\":\"yyyy-MM-dd\",\"datePattern\":\"date_sub\",\"dateStyle\":\"y_M_d\",\"deExtractType\":0,\"deType\":1,\"extField\":0,\"filter\":[],\"id\":\"e748df7a-2152-4353-82cd-9115931b6ecd\",\"lastSyncTime\":1690971394498,\"name\":\"publish_time\",\"originName\":\"publish_time\",\"sort\":\"none\",\"tableId\":\"060532ec-50d2-43a2-8e5f-300d9d75bc57\",\"type\":\"CHARACTER VARYING\"},{\"checked\":true,\"columnIndex\":0,\"dataeaseName\":\"C_99bea2cd698b56b1a3b8c1701bd51c67\",\"datePattern\":\"date_sub\",\"dateStyle\":\"y_M_d\",\"deExtractType\":2,\"deType\":2,\"extField\":0,\"filter\":[],\"id\":\"32ef70b7-9e6b-4571-b41c-4aac3516721d\",\"lastSyncTime\":1690971394498,\"name\":\"pv\",\"originName\":\"pv\",\"sort\":\"none\",\"tableId\":\"060532ec-50d2-43a2-8e5f-300d9d75bc57\",\"type\":\"INTEGER\"}]";
        List<ChartViewFieldDTO> xAxis = JSONObject.parseArray(xAxisStr, ChartViewFieldDTO.class);

        String fieldCustomFilterStr = "";
        List<ChartFieldCustomFilterDTO> fieldCustomFilter = JSONObject.parseArray(fieldCustomFilterStr, ChartFieldCustomFilterDTO.class);

        String extFilterListStr = "[{\"componentId\":\"d43495e0-311e-11ee-bcee-cf52a38ad2d7\",\"datasetTableField\":{\"accuracy\":0,\"checked\":true,\"columnIndex\":2,\"dataeaseName\":\"C_0faea619a3eb6dfca4ced9bbe5bf4c9a\",\"dateFormat\":\"yyyy-MM-dd\",\"dateFormatType\":\"yyyy-MM-dd\",\"deExtractType\":0,\"deType\":1,\"extField\":0,\"groupType\":\"d\",\"id\":\"e748df7a-2152-4353-82cd-9115931b6ecd\",\"lastSyncTime\":1690971394498,\"name\":\"publish_time\",\"originName\":\"publish_time\",\"size\":65536,\"tableId\":\"060532ec-50d2-43a2-8e5f-300d9d75bc57\",\"type\":\"CHARACTER VARYING\"},\"fieldId\":\"e748df7a-2152-4353-82cd-9115931b6ecd\",\"isTree\":false,\"operator\":\"between\",\"parameters\":[],\"value\":[\"1690819200000\",\"1693497599999\"],\"viewIds\":[]}]";
        List<ChartExtFilterRequest> extFilterList = JSONObject.parseArray(extFilterListStr, ChartExtFilterRequest.class);

        String datasourceStr = "{\"configuration\":\"{\\\"initialPoolSize\\\":5,\\\"extraParams\\\":\\\"\\\",\\\"minPoolSize\\\":5,\\\"maxPoolSize\\\":50,\\\"maxIdleTime\\\":30,\\\"acquireIncrement\\\":5,\\\"idleConnectionTestPeriod\\\":5,\\\"connectTimeout\\\":5,\\\"customDriver\\\":\\\"default\\\",\\\"queryTimeout\\\":30,\\\"username\\\":\\\"zq\\\",\\\"password\\\":\\\"Calong@2015\\\",\\\"host\\\":\\\"localhost\\\",\\\"port\\\":\\\"31010\\\",\\\"dataBase\\\":\\\"dataease\\\"}\",\"createBy\":\"admin\",\"createTime\":1690971005096,\"id\":\"304d09f4-d5e9-4566-9ce9-352611e8377f\",\"name\":\"local\",\"status\":\"Success\",\"type\":\"dremio\",\"updateTime\":1690971005096}";
        Datasource datasource = JSONObject.parseObject(datasourceStr, Datasource.class);

        String viewStr = "{\"chartType\":\"private\",\"createBy\":\"admin\",\"createTime\":1690971897000,\"customAttr\":\"{\\\"color\\\":{\\\"value\\\":\\\"default\\\",\\\"colors\\\":[\\\"#5470c6\\\",\\\"#91cc75\\\",\\\"#fac858\\\",\\\"#ee6666\\\",\\\"#73c0de\\\",\\\"#3ba272\\\",\\\"#fc8452\\\",\\\"#9a60b4\\\",\\\"#ea7ccc\\\"],\\\"alpha\\\":100,\\\"tableHeaderBgColor\\\":\\\"#6D9A49\\\",\\\"tableItemBgColor\\\":\\\"#FFFFFF\\\",\\\"tableHeaderFontColor\\\":\\\"#000000\\\",\\\"tableFontColor\\\":\\\"#000000\\\",\\\"tableStripe\\\":true,\\\"dimensionColor\\\":\\\"#000000\\\",\\\"quotaColor\\\":\\\"#5470c6\\\",\\\"tableBorderColor\\\":\\\"#E6E7E4\\\",\\\"seriesColors\\\":[],\\\"areaBorderColor\\\":\\\"#303133\\\",\\\"gradient\\\":false,\\\"areaBaseColor\\\":\\\"#FFFFFF\\\",\\\"tableScrollBarColor\\\":\\\"rgba(0, 0, 0, 0.15)\\\",\\\"tableScrollBarHoverColor\\\":\\\"rgba(0, 0, 0, 0.4)\\\",\\\"mapStyle\\\":\\\"normal\\\",\\\"mapLineGradient\\\":false,\\\"mapLineSourceColor\\\":\\\"#146C94\\\",\\\"mapLineTargetColor\\\":\\\"#576CBC\\\"},\\\"tableColor\\\":{\\\"value\\\":\\\"default\\\",\\\"colors\\\":[\\\"#5470c6\\\",\\\"#91cc75\\\",\\\"#fac858\\\",\\\"#ee6666\\\",\\\"#73c0de\\\",\\\"#3ba272\\\",\\\"#fc8452\\\",\\\"#9a60b4\\\",\\\"#ea7ccc\\\"],\\\"alpha\\\":100,\\\"tableHeaderBgColor\\\":\\\"#6D9A49\\\",\\\"tableItemBgColor\\\":\\\"#FFFFFF\\\",\\\"tableHeaderFontColor\\\":\\\"#000000\\\",\\\"tableFontColor\\\":\\\"#000000\\\",\\\"tableStripe\\\":true,\\\"dimensionColor\\\":\\\"#000000\\\",\\\"quotaColor\\\":\\\"#5470c6\\\",\\\"tableBorderColor\\\":\\\"#E6E7E4\\\",\\\"seriesColors\\\":[],\\\"areaBorderColor\\\":\\\"#303133\\\",\\\"gradient\\\":false,\\\"areaBaseColor\\\":\\\"#FFFFFF\\\",\\\"tableScrollBarColor\\\":\\\"rgba(0, 0, 0, 0.15)\\\",\\\"tableScrollBarHoverColor\\\":\\\"rgba(0, 0, 0, 0.4)\\\",\\\"mapStyle\\\":\\\"normal\\\",\\\"mapLineGradient\\\":false,\\\"mapLineSourceColor\\\":\\\"#146C94\\\",\\\"mapLineTargetColor\\\":\\\"#576CBC\\\"},\\\"size\\\":{\\\"barDefault\\\":true,\\\"barWidth\\\":40,\\\"barGap\\\":0.4,\\\"lineWidth\\\":2,\\\"lineType\\\":\\\"solid\\\",\\\"lineSymbol\\\":\\\"circle\\\",\\\"lineSymbolSize\\\":4,\\\"lineSmooth\\\":true,\\\"lineArea\\\":false,\\\"pieInnerRadius\\\":0,\\\"pieOuterRadius\\\":80,\\\"pieRoseType\\\":\\\"radius\\\",\\\"pieRoseRadius\\\":5,\\\"funnelWidth\\\":80,\\\"radarShape\\\":\\\"polygon\\\",\\\"radarSize\\\":80,\\\"tableTitleFontSize\\\":12,\\\"tableItemFontSize\\\":12,\\\"tableTitleHeight\\\":36,\\\"tableItemHeight\\\":36,\\\"tablePageSize\\\":\\\"20\\\",\\\"tableColumnMode\\\":\\\"custom\\\",\\\"tableColumnWidth\\\":100,\\\"tableHeaderAlign\\\":\\\"left\\\",\\\"tableItemAlign\\\":\\\"right\\\",\\\"tableAutoBreakLine\\\":false,\\\"gaugeMinType\\\":\\\"fix\\\",\\\"gaugeMinField\\\":{\\\"id\\\":\\\"\\\",\\\"summary\\\":\\\"\\\"},\\\"gaugeMin\\\":0,\\\"gaugeMaxType\\\":\\\"fix\\\",\\\"gaugeMaxField\\\":{\\\"id\\\":\\\"\\\",\\\"summary\\\":\\\"\\\"},\\\"gaugeMax\\\":100,\\\"gaugeStartAngle\\\":225,\\\"gaugeEndAngle\\\":-45,\\\"gaugeTickCount\\\":5,\\\"dimensionFontSize\\\":18,\\\"quotaFontSize\\\":18,\\\"spaceSplit\\\":10,\\\"dimensionShow\\\":true,\\\"quotaShow\\\":true,\\\"quotaFontFamily\\\":\\\"Microsoft YaHei\\\",\\\"quotaFontIsBolder\\\":false,\\\"quotaFontIsItalic\\\":false,\\\"quotaLetterSpace\\\":\\\"0\\\",\\\"quotaFontShadow\\\":false,\\\"dimensionFontFamily\\\":\\\"Microsoft YaHei\\\",\\\"dimensionFontIsBolder\\\":false,\\\"dimensionFontIsItalic\\\":false,\\\"dimensionLetterSpace\\\":\\\"0\\\",\\\"dimensionFontShadow\\\":false,\\\"scatterSymbol\\\":\\\"circle\\\",\\\"scatterSymbolSize\\\":20,\\\"treemapWidth\\\":80,\\\"treemapHeight\\\":80,\\\"liquidMax\\\":100,\\\"liquidMaxType\\\":\\\"fix\\\",\\\"liquidMaxField\\\":{\\\"id\\\":\\\"\\\",\\\"summary\\\":\\\"\\\"},\\\"liquidSize\\\":80,\\\"liquidOutlineBorder\\\":4,\\\"liquidOutlineDistance\\\":8,\\\"liquidWaveLength\\\":128,\\\"liquidWaveCount\\\":3,\\\"liquidShape\\\":\\\"circle\\\",\\\"tablePageMode\\\":\\\"page\\\",\\\"symbolOpacity\\\":0.7,\\\"symbolStrokeWidth\\\":2,\\\"showIndex\\\":false,\\\"indexLabel\\\":\\\"序号\\\",\\\"hPosition\\\":\\\"center\\\",\\\"vPosition\\\":\\\"center\\\",\\\"mapPitch\\\":0,\\\"mapLineType\\\":\\\"arc\\\",\\\"mapLineWidth\\\":1,\\\"mapLineAnimate\\\":true,\\\"mapLineAnimateDuration\\\":3,\\\"mapLineAnimateInterval\\\":1,\\\"mapLineAnimateTrailLength\\\":1},\\\"label\\\":{\\\"show\\\":true,\\\"position\\\":\\\"inside\\\",\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"10\\\",\\\"formatter\\\":\\\"{c}\\\",\\\"gaugeFormatter\\\":\\\"{value}\\\",\\\"labelLine\\\":{\\\"show\\\":true},\\\"gaugeLabelFormatter\\\":{\\\"type\\\":\\\"value\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true},\\\"reserveDecimalCount\\\":2,\\\"labelContent\\\":[\\\"dimension\\\",\\\"proportion\\\"]},\\\"tooltip\\\":{\\\"show\\\":true,\\\"trigger\\\":\\\"item\\\",\\\"confine\\\":true,\\\"textStyle\\\":{\\\"fontSize\\\":\\\"10\\\",\\\"color\\\":\\\"#000000\\\"},\\\"formatter\\\":\\\"\\\",\\\"backgroundColor\\\":\\\"#FFFFFF\\\"},\\\"totalCfg\\\":{\\\"row\\\":{\\\"showGrandTotals\\\":true,\\\"showSubTotals\\\":true,\\\"reverseLayout\\\":false,\\\"reverseSubLayout\\\":false,\\\"label\\\":\\\"总计\\\",\\\"subLabel\\\":\\\"小计\\\",\\\"subTotalsDimensions\\\":[],\\\"calcTotals\\\":{\\\"aggregation\\\":\\\"SUM\\\"},\\\"calcSubTotals\\\":{\\\"aggregation\\\":\\\"SUM\\\"},\\\"totalSort\\\":\\\"none\\\",\\\"totalSortField\\\":\\\"\\\"},\\\"col\\\":{\\\"showGrandTotals\\\":true,\\\"showSubTotals\\\":true,\\\"reverseLayout\\\":false,\\\"reverseSubLayout\\\":false,\\\"label\\\":\\\"总计\\\",\\\"subLabel\\\":\\\"小计\\\",\\\"subTotalsDimensions\\\":[],\\\"calcTotals\\\":{\\\"aggregation\\\":\\\"SUM\\\"},\\\"calcSubTotals\\\":{\\\"aggregation\\\":\\\"SUM\\\"},\\\"totalSort\\\":\\\"none\\\",\\\"totalSortField\\\":\\\"\\\"}}}\",\"customFilter\":\"[]\",\"customStyle\":\"{\\\"text\\\":{\\\"show\\\":true,\\\"fontSize\\\":\\\"18\\\",\\\"color\\\":\\\"#000000\\\",\\\"hPosition\\\":\\\"left\\\",\\\"vPosition\\\":\\\"top\\\",\\\"isItalic\\\":false,\\\"isBolder\\\":true,\\\"remarkShow\\\":false,\\\"remark\\\":\\\"\\\",\\\"remarkBackgroundColor\\\":\\\"#ffffffff\\\",\\\"fontFamily\\\":\\\"Microsoft YaHei\\\",\\\"letterSpace\\\":\\\"0\\\",\\\"fontShadow\\\":false},\\\"legend\\\":{\\\"show\\\":false,\\\"hPosition\\\":\\\"center\\\",\\\"vPosition\\\":\\\"bottom\\\",\\\"orient\\\":\\\"horizontal\\\",\\\"icon\\\":\\\"circle\\\",\\\"textStyle\\\":{\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\"}},\\\"xAxis\\\":{\\\"show\\\":true,\\\"position\\\":\\\"bottom\\\",\\\"name\\\":\\\"\\\",\\\"nameTextStyle\\\":{\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":12},\\\"axisLabel\\\":{\\\"show\\\":true,\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\",\\\"rotate\\\":0,\\\"formatter\\\":\\\"{value}\\\"},\\\"axisLine\\\":{\\\"show\\\":true,\\\"lineStyle\\\":{\\\"color\\\":\\\"#cccccc\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"splitLine\\\":{\\\"show\\\":false,\\\"lineStyle\\\":{\\\"color\\\":\\\"#CCCCCC\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"axisValue\\\":{\\\"auto\\\":true,\\\"min\\\":null,\\\"max\\\":null,\\\"split\\\":null,\\\"splitCount\\\":null},\\\"axisLabelFormatter\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true}},\\\"yAxis\\\":{\\\"show\\\":true,\\\"position\\\":\\\"left\\\",\\\"name\\\":\\\"\\\",\\\"nameTextStyle\\\":{\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":12},\\\"axisLabel\\\":{\\\"show\\\":true,\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\",\\\"rotate\\\":0,\\\"formatter\\\":\\\"{value}\\\"},\\\"axisLine\\\":{\\\"show\\\":false,\\\"lineStyle\\\":{\\\"color\\\":\\\"#cccccc\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"splitLine\\\":{\\\"show\\\":true,\\\"lineStyle\\\":{\\\"color\\\":\\\"#CCCCCC\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"axisValue\\\":{\\\"auto\\\":true,\\\"min\\\":null,\\\"max\\\":null,\\\"split\\\":null,\\\"splitCount\\\":null},\\\"axisLabelFormatter\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true}},\\\"yAxisExt\\\":{\\\"show\\\":true,\\\"position\\\":\\\"right\\\",\\\"name\\\":\\\"\\\",\\\"nameTextStyle\\\":{\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":12},\\\"axisLabel\\\":{\\\"show\\\":true,\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\",\\\"rotate\\\":0,\\\"formatter\\\":\\\"{value}\\\"},\\\"axisLine\\\":{\\\"show\\\":false,\\\"lineStyle\\\":{\\\"color\\\":\\\"#cccccc\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"splitLine\\\":{\\\"show\\\":true,\\\"lineStyle\\\":{\\\"color\\\":\\\"#CCCCCC\\\",\\\"width\\\":1,\\\"style\\\":\\\"solid\\\"}},\\\"axisValue\\\":{\\\"auto\\\":true,\\\"min\\\":null,\\\"max\\\":null,\\\"split\\\":null,\\\"splitCount\\\":null},\\\"axisLabelFormatter\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true}},\\\"split\\\":{\\\"name\\\":{\\\"show\\\":true,\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\"},\\\"splitNumber\\\":5,\\\"axisLine\\\":{\\\"show\\\":true,\\\"lineStyle\\\":{\\\"color\\\":\\\"#CCCCCC\\\",\\\"width\\\":1,\\\"type\\\":\\\"solid\\\"}},\\\"axisTick\\\":{\\\"show\\\":false,\\\"length\\\":5,\\\"lineStyle\\\":{\\\"color\\\":\\\"#000000\\\",\\\"width\\\":1,\\\"type\\\":\\\"solid\\\"}},\\\"axisLabel\\\":{\\\"show\\\":false,\\\"rotate\\\":0,\\\"margin\\\":8,\\\"color\\\":\\\"#000000\\\",\\\"fontSize\\\":\\\"12\\\",\\\"formatter\\\":\\\"{value}\\\"},\\\"splitLine\\\":{\\\"show\\\":true,\\\"lineStyle\\\":{\\\"color\\\":\\\"#CCCCCC\\\",\\\"width\\\":1,\\\"type\\\":\\\"solid\\\"}},\\\"splitArea\\\":{\\\"show\\\":true}}}\",\"dataFrom\":\"dataset\",\"datasetMode\":0,\"datasourceType\":\"dremio\",\"drill\":false,\"drillFields\":\"[]\",\"extBubble\":\"[]\",\"extStack\":\"[]\",\"id\":\"103e32e9-2a48-47c9-952d-09ac572840d3\",\"isPlugin\":false,\"name\":\"饼图-1\",\"refreshTime\":5,\"refreshUnit\":\"minute\",\"refreshViewEnable\":false,\"render\":\"echarts\",\"resultCount\":1000,\"resultMode\":\"custom\",\"sceneId\":\"c0886c17-311e-11ee-ba31-ed8e41310586\",\"senior\":\"{\\\"functionCfg\\\":{\\\"sliderShow\\\":false,\\\"sliderRange\\\":[0,10],\\\"sliderBg\\\":\\\"#FFFFFF\\\",\\\"sliderFillBg\\\":\\\"#BCD6F1\\\",\\\"sliderTextClolor\\\":\\\"#999999\\\",\\\"emptyDataStrategy\\\":\\\"breakLine\\\",\\\"emptyDataFieldCtrl\\\":[]},\\\"assistLine\\\":[],\\\"threshold\\\":{}}\",\"stylePriority\":\"view\",\"tableId\":\"060532ec-50d2-43a2-8e5f-300d9d75bc57\",\"title\":\"饼图-1\",\"totalItems\":0,\"totalPage\":0,\"type\":\"table-info\",\"updateTime\":1690971943856,\"viewFields\":\"[]\",\"xAxis\":\"[{\\\"id\\\":\\\"9956a71f-56c4-4181-aeb0-80d6a2694120\\\",\\\"tableId\\\":\\\"060532ec-50d2-43a2-8e5f-300d9d75bc57\\\",\\\"originName\\\":\\\"user\\\",\\\"name\\\":\\\"user\\\",\\\"dataeaseName\\\":\\\"C_ee11cbb19052e40b07aac0ca060c23ee\\\",\\\"groupType\\\":\\\"d\\\",\\\"type\\\":\\\"CHARACTER VARYING\\\",\\\"size\\\":65536,\\\"deType\\\":0,\\\"deTypeFormat\\\":null,\\\"deExtractType\\\":0,\\\"extField\\\":0,\\\"checked\\\":true,\\\"columnIndex\\\":4,\\\"lastSyncTime\\\":1690971394498,\\\"accuracy\\\":0,\\\"dateFormat\\\":null,\\\"dateFormatType\\\":null,\\\"disabled\\\":true,\\\"formatterCfg\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true},\\\"dateStyle\\\":\\\"y_M_d\\\",\\\"datePattern\\\":\\\"date_sub\\\",\\\"sort\\\":\\\"none\\\",\\\"filter\\\":[]},{\\\"id\\\":\\\"e748df7a-2152-4353-82cd-9115931b6ecd\\\",\\\"tableId\\\":\\\"060532ec-50d2-43a2-8e5f-300d9d75bc57\\\",\\\"originName\\\":\\\"publish_time\\\",\\\"name\\\":\\\"publish_time\\\",\\\"dataeaseName\\\":\\\"C_0faea619a3eb6dfca4ced9bbe5bf4c9a\\\",\\\"groupType\\\":\\\"d\\\",\\\"type\\\":\\\"CHARACTER VARYING\\\",\\\"size\\\":65536,\\\"deType\\\":1,\\\"deTypeFormat\\\":null,\\\"deExtractType\\\":0,\\\"extField\\\":0,\\\"checked\\\":true,\\\"columnIndex\\\":2,\\\"lastSyncTime\\\":1690971394498,\\\"accuracy\\\":0,\\\"dateFormat\\\":\\\"yyyy-MM-dd\\\",\\\"dateFormatType\\\":\\\"yyyy-MM-dd\\\",\\\"disabled\\\":true,\\\"formatterCfg\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true},\\\"dateStyle\\\":\\\"y_M_d\\\",\\\"datePattern\\\":\\\"date_sub\\\",\\\"sort\\\":\\\"none\\\",\\\"filter\\\":[]},{\\\"id\\\":\\\"32ef70b7-9e6b-4571-b41c-4aac3516721d\\\",\\\"tableId\\\":\\\"060532ec-50d2-43a2-8e5f-300d9d75bc57\\\",\\\"originName\\\":\\\"pv\\\",\\\"name\\\":\\\"pv\\\",\\\"dataeaseName\\\":\\\"C_99bea2cd698b56b1a3b8c1701bd51c67\\\",\\\"groupType\\\":\\\"q\\\",\\\"type\\\":\\\"INTEGER\\\",\\\"size\\\":32,\\\"deType\\\":2,\\\"deTypeFormat\\\":null,\\\"deExtractType\\\":2,\\\"extField\\\":0,\\\"checked\\\":true,\\\"columnIndex\\\":0,\\\"lastSyncTime\\\":1690971394498,\\\"accuracy\\\":0,\\\"dateFormat\\\":null,\\\"dateFormatType\\\":null,\\\"disabled\\\":true,\\\"formatterCfg\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true},\\\"dateStyle\\\":\\\"y_M_d\\\",\\\"datePattern\\\":\\\"date_sub\\\",\\\"sort\\\":\\\"none\\\",\\\"filter\\\":[]}]\",\"xAxisExt\":\"[]\",\"yAxis\":\"[{\\\"id\\\":\\\"32ef70b7-9e6b-4571-b41c-4aac3516721d\\\",\\\"tableId\\\":\\\"060532ec-50d2-43a2-8e5f-300d9d75bc57\\\",\\\"originName\\\":\\\"pv\\\",\\\"name\\\":\\\"pv\\\",\\\"dataeaseName\\\":\\\"C_99bea2cd698b56b1a3b8c1701bd51c67\\\",\\\"groupType\\\":\\\"q\\\",\\\"type\\\":\\\"INTEGER\\\",\\\"size\\\":32,\\\"deType\\\":2,\\\"deTypeFormat\\\":null,\\\"deExtractType\\\":2,\\\"extField\\\":0,\\\"checked\\\":true,\\\"columnIndex\\\":0,\\\"lastSyncTime\\\":1690971394498,\\\"accuracy\\\":0,\\\"dateFormat\\\":null,\\\"dateFormatType\\\":null,\\\"disabled\\\":true,\\\"compareCalc\\\":{\\\"type\\\":\\\"none\\\",\\\"resultData\\\":\\\"percent\\\",\\\"field\\\":\\\"\\\",\\\"custom\\\":{\\\"field\\\":\\\"\\\",\\\"calcType\\\":\\\"0\\\",\\\"timeType\\\":\\\"0\\\",\\\"currentTime\\\":\\\"\\\",\\\"compareTime\\\":\\\"\\\",\\\"currentTimeRange\\\":[],\\\"compareTimeRange\\\":[]}},\\\"formatterCfg\\\":{\\\"type\\\":\\\"auto\\\",\\\"unit\\\":1,\\\"suffix\\\":\\\"\\\",\\\"decimalCount\\\":2,\\\"thousandSeparator\\\":true},\\\"chartType\\\":\\\"bar\\\",\\\"summary\\\":\\\"sum\\\",\\\"sort\\\":\\\"none\\\",\\\"filter\\\":[]}]\",\"yAxisExt\":\"[]\"}";
        ChartViewDTO view = JSONObject.parseObject(viewStr, ChartViewDTO.class);

        String pageStr = "{\"dsVersion\":\"\",\"goPage\":50,\"pageSize\":20}";
        PageInfo pageInfo = JSONObject.parseObject(pageStr, PageInfo.class);


        try {
            String querySql = qp.getSQLWithPage(true, "文章", xAxis, null, null, extFilterList, datasource, view, pageInfo);
            System.out.println(querySql);
        } catch (Exception exception) {
            System.out.println(exception.getMessage());
        }

    }
}
